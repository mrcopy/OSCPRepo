<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Identify Alive IPs</title>
</head><body>Identifying Alive IP Addresses:<br/>
Nmap by default provides a -sn Ping scan option. The default host discovery done with -sn consists of an ICMP echo request, TCP SYN to port 443, TCP ACK to port 80, and an ICMP timestamp request by default. This works as if ICMP echo request is blocked, nmap would know if a host is alive if it receives any response from port 443 or 80 or timestamp reply. <br/>
<br/>
Let's see what the nmap does when do a ping scan.<br/>
nmap -sn -n 10.0.0.230<br/>
#My IP is 10.0.0.1<br/>
<br/>
It is very important to mention that -n option (No DNS resolution) should be used going forward as we have already did DNS resolution while using List scan. Since DNS can be slow even with Nmap's built-in parallel stub resolver, this option can slash scanning times. <br/>
<br/>
TCP Dump output is presented here. As both the IP address are in the same subnet, nmap would use ARP Ping scan to find the alive IP Address.<br/>
22:11:27.292054 ARP, Request who-has 10.0.0.230 (Broadcast) tell 10.0.0.1, length 28<br/>
22:11:27.361100 ARP, Reply 10.0.0.230 is-at 8c:64:22:3b:2b:2d (oui Unknown), length 28<br/>
<br/>
However, this behavior can be changed using --disable-arp-ping<br/>
nmap -sn 10.0.0.230 --disable-arp-ping<br/>
<br/>
TCPdump output is as below: One ICMP Echo Request, SYN to Port 443, ACK to Port 80 and a time stamp request.<br/>
22:14:02.742180 IP 10.0.0.1 &gt; 10.0.0.230: ICMP echo request, id 45066, seq 0, length 8<br/>
22:14:02.742222 IP 10.0.0.1.59246 &gt; 10.0.0.230.https: Flags [S], seq 3994420539, win 1024, options [mss 1460], length 0<br/>
22:14:02.742234 IP 10.0.0.1.59246 &gt; 10.0.0.230.http: Flags [.], ack 3994420539, win 1024, length 0<br/>
22:14:02.742241 IP 10.0.0.1 &gt; 10.0.0.230: ICMP time stamp query id 38635 seq 0, length 20<br/>
22:14:02.801243 IP 10.0.0.230 &gt; 10.0.0.1: ICMP echo reply, id 45066, seq 0, length 8<br/>
22:14:02.801930 IP 10.0.0.230.https &gt; 10.0.0.1.59246: Flags [R.], seq 0, ack 3994420540, win 0, length 0<br/>
22:14:02.805083 IP 10.0.0.230.http &gt; 10.0.0.1.59246: Flags [R], seq 3994420539, win 0, length 0<br/>
22:14:02.805930 IP 10.0.0.230 &gt; 10.0.0.1: ICMP time stamp reply id 38635 seq 0: org 00:00:00.000, recv 16:40:52.731, xmit 16:40:52.731, length 20<br/>
<br/>
If you use --reason option, nmap would tell why it thinks the host is alive. In the below case (received echo-reply).<br/>
Nmap scan report for 10.0.0.230<br/>
Host is up, received echo-reply (0.073s latency).<br/>
<br/>
If we only want to send ICMP Ping query ( as if the host replies to it, the other three packets (SYN 443, ACK 80 and Timestamp ) are extra burden. ( I may be wrong here) We can use<br/>
nmap -n -sn -PE --disable-arp-ping 10.0.0.230 <br/>
<br/>
TCP Dump output:<br/>
22:30:20.768525 IP 10.0.0.1 &gt; 10.0.0.230: ICMP echo request, id 39366, seq 0, length 8<br/>
22:30:20.826098 IP 10.0.0.230 &gt; 10.0.0.1: ICMP echo reply, id 39366, seq 0, length 8<br/>
<br/>
Please note, this ICMP scan would miss all the host which are alive but the firewall is dropping the ICMP echo request packet. However, if you want to find more hosts, it would be advisable to separate the list of IPs which responded to ICMP from the IP address scan range and run the scan again may be with SYN to 443 and ACK to 80 using PA, PS options. <br/>
<br/>
Please also note Nmap's ICMP ping, by default, sends zero data as part of the ping. Nmap typically pings the host via icmp if the user has root privileges, and uses a tcp-ping otherwise. This is easily detected by the Snort IDS Rule 1-469 SID 1-469. <br/>
<br/>
This could be evaded by using<br/>
--data &lt;hex string&gt; (Append custom binary data to sent packets)<br/>
--data-string &lt;string&gt; (Append custom string to sent packets)<br/>
--data-length &lt;number&gt; (Append random data to sent packets)<br/>
<br/>
Please note that you should use this options only on ICMP Echo Request for IDS Evasion as the data gets appended to every packet (ex. port scan packets). <br/>
<br/>
Designing the ideal combinations of probes as suggested in the Nmap Book is<br/>
-PE -PA -PS 21,22,23,25,80,113,31339 -PA 80,113,443,10042<br/>
Adding --source-port 53 might also help<br/>
<br/>
-PS/PA/PU/PY: TCP SYN/ACK, UDP or SCTP discovery<br/>
-PE/PP/PM: ICMP echo, timestamp, and netmask request discovery<br/>
<br/>
The above combination would find more hosts than just the ping scan, however it also gonna cost a decent amount of time. Normal Time vs Accuracy trade off.</body></html>