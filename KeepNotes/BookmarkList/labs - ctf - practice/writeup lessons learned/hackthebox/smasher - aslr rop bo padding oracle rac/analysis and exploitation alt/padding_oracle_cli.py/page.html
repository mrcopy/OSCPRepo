<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Padding_oracle_cli.py</title>
</head><body>from __future__ import print_function<br/>
<br/>
import socket<br/>
import logging<br/>
import argparse<br/>
<br/>
from base64 import b64encode, b64decode<br/>
from urllib import quote, unquote<br/>
<br/>
from paddingoracle import BadPaddingException, PaddingOracle<br/>
<br/>
BUFLEN = 256<br/>
<br/>
<br/>
class PadBuster(PaddingOracle):<br/>
&nbsp; &nbsp; def __init__(self, args, **kwargs):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; super(PadBuster, self).__init__(**kwargs)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; self.args = args<br/>
<br/>
&nbsp; &nbsp; def oracle(self, data, **kwargs):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; attempt = b64encode(data)<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; sock = socket.create_connection((self.args.target, self.args.port))<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; resp = ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; while True:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if 'Insert ciphertext' in resp:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resp = sock.recv(BUFLEN)<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; sock.send(attempt + '\n')<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; resp = sock.recv(BUFLEN)<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if 'Invalid Padding' in resp:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; raise BadPaddingException<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; logging.debug('Got one: {}'.format(attempt))<br/>
<br/>
<br/>
if __name__ == '__main__':<br/>
&nbsp; &nbsp; parser = argparse.ArgumentParser()<br/>
<br/>
&nbsp; &nbsp; parser.add_argument('-b', '--blocksize', help='block size', choices=[8, 16], default=8, type=int)<br/>
&nbsp; &nbsp; parser.add_argument('-p', '--port', help="oracle's port", default=1337, type=int)<br/>
&nbsp; &nbsp; parser.add_argument('-l', '--loglevel', help='logging level (default=DEBUG)', default='DEBUG',<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; choices=['DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'])<br/>
&nbsp; &nbsp; parser.add_argument('ciphertext', help="ciphertext to crack")<br/>
&nbsp; &nbsp; parser.add_argument('target', help="oracle's ip address")<br/>
<br/>
&nbsp; &nbsp; args = parser.parse_args()<br/>
<br/>
&nbsp; &nbsp; logging.basicConfig(level=args.loglevel)<br/>
<br/>
&nbsp; &nbsp; padbuster = PadBuster(args)<br/>
<br/>
&nbsp; &nbsp; encrypted_text = b64decode(unquote(args.ciphertext))<br/>
<br/>
&nbsp; &nbsp; plaintext = padbuster.decrypt(encrypted_text, block_size=args.blocksize, iv=bytearray(8))<br/>
<br/>
&nbsp; &nbsp; print('Decrypted ciphertext: {} =&gt; {!r}'.format(args.ciphertext, plaintext))</body></html>