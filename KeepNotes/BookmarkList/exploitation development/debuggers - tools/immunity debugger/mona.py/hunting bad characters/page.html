<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Hunting Bad Characters</title>
</head><body>In Immunity Debugger, set where mona will be logging all of its output<br/>
!mona config -set workingfolder c:\logs\%p<br/>
<br/>
Now we need to generate a byte array for comparison. In Immunity, run the command:<br/>
!mona bytearray -b "\x00" &#09;&#09;&#09;&#09;#I always exclude null byte<br/>
(look at manual for other flags)<br/>
<br/>
Go to logging directory set in the first step and copy list of bad characters generated in 'bytearray.txt' to your exploit. Please note that exploit MUST match 'bytearray.txt' for this to work properly. <br/>
<br/>
Run exploit and make sure it's 'badchars' variable matches 'bytearray.txt'<br/>
<br/>
Exploit may crash, run the command in Immunity:<br/>
!mona compare -f C:\logs\program_name\bytearray.bin -a &lt;badchars_start_address&gt;<br/>
<br/>
This will compare chars in 'bytearray.txt' with those in memory (pushed by the exploit) and split ones that cause the program to act funny. Please note that the memory address needes to be accurate. If 'badchars' in exploit start 2 bytes after left-hand side address in Immunity, you'd need to increment that by two bytes in the above command<br/>
<br/>
Rinse and repeat<br/>
<br/>
<br/>
<br/>
!mona compare -f C:\Users\Offsec\Desktop\offsec_pwk_srv\bytearray.bin -a 002AED14</body></html>